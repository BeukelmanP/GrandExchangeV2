<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AuctionController.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;GrandExchange_news&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">Controllers</a> &gt; <span class="el_source">AuctionController.java</span></div><h1>AuctionController.java</h1><pre class="source lang-java linenums">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Controllers;

import Classes.Auctions.Auction;
import Classes.Auctions.Countdown;
import Classes.Auctions.Direct;
import Classes.Auctions.Standard;
import Classes.Auctions.StatusEnum;
import Classes.Bid;
import Classes.Grand_Exchange;
import Classes.User;
import Exceptions.NotEnoughMoneyException;
import Interfaces.IAuction;
import Interfaces.IPlaceBid;
import grandexchange.RegistryManager;
import java.net.URL;
import java.rmi.RemoteException;
import java.sql.SQLException;
import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.Collections;
import java.util.ResourceBundle;
import java.util.logging.Level;
import java.util.logging.Logger;
import javafx.animation.KeyFrame;
import javafx.animation.Timeline;
import javafx.beans.value.ChangeListener;
import javafx.beans.value.ObservableValue;
import javafx.event.Event;
import javafx.event.EventHandler;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.control.ProgressBar;
import javafx.scene.control.ScrollPane;
import javafx.scene.control.TextArea;
import javafx.scene.control.TextField;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import javafx.scene.input.MouseEvent;
import javafx.scene.layout.Pane;
import javafx.scene.text.Font;
import javafx.stage.Stage;
import javafx.util.Duration;
import javax.swing.JOptionPane;

/**
 * FXML Controller class
 *
 * @author piete
 */
<span class="nc" id="L57">public class AuctionController implements Initializable {</span>

    @FXML
    private ImageView bigProductImage;
    @FXML
    private ImageView sellerImage;
    @FXML
    private Label sellerName;
    @FXML
    private Label productTitle;
    @FXML
    private Label auctiontype;
    @FXML
    private Label productStatus;
    @FXML
    private Label countdownCurrentPrice;
    @FXML
    private Label InstabuyCurrentPrice;
    @FXML
    private Label countdownAvailableUnits;
    @FXML
    private Label instabuyTextid;
    @FXML
    private Label CreateDate;
    @FXML
    private Label lblUnits;
    @FXML
    private Label lblBid;
    @FXML
    private TextArea productDescription;
    @FXML
    private TextArea auctionDescription;
    @FXML
    private Button closeButton;
    @FXML
    private Button countdownBuyBtn;
    @FXML
    private TextField txtUnitstoBuy;
    @FXML
    private ScrollPane imagesPane;
    @FXML
    private ScrollPane recentPurchasesPane;
    @FXML
    private ProgressBar minutesBar;
    @FXML
    private Button countdownBidBuyBtn;
    @FXML
    private TextField txtUnitstoBuyBid;
    @FXML
    private TextField txtPriceToBid;
    @FXML
    private Button BidBtn;
    @FXML
    private Button buyButton;

    IAuction auctionInterface;
    IPlaceBid bid;
    Auction auction;
    Direct directAuction;
    Standard standardAuction;
    Grand_Exchange GX;
    private User loggedInUser;
    private String type;
    private RegistryManager RM;
    Timeline timeline1;
    Timeline timeline;
    int timeSeconds;

    /**
     * Initializes the controller class.
     *
     * @param url
     * @param rb
     */
    @Override
    public void initialize(URL url, ResourceBundle rb) {

<span class="nc" id="L134">    }</span>

    public void setUp(Auction auction, RegistryManager RM) throws RemoteException {
<span class="nc" id="L137">        this.GX = new Grand_Exchange();</span>
<span class="nc" id="L138">        this.RM = RM;</span>
<span class="nc" id="L139">        this.auction = auction;</span>
<span class="nc" id="L140">        loggedInUser = RM.getUser();</span>
<span class="nc" id="L141">        update();</span>
<span class="nc" id="L142">        timeline1 = new Timeline();</span>
<span class="nc" id="L143">        timeline1.getKeyFrames().add(new KeyFrame(Duration.seconds(5), new EventHandler() {</span>

            @Override
            public void handle(Event event) {
<span class="nc" id="L147">                liveUpdate();</span>
<span class="nc" id="L148">            }</span>
        }));
<span class="nc" id="L150">        timeline1.playFromStart();</span>

<span class="nc" id="L152">    }</span>

    public void liveUpdate() {
<span class="nc" id="L155">        int updateid = auction.getId();</span>
        try {
<span class="nc" id="L157">            auction = RM.getAuction().getAuction(updateid);</span>
<span class="nc" id="L158">        } catch (RemoteException ex) {</span>
<span class="nc" id="L159">            Logger.getLogger(AuctionController.class.getName()).log(Level.SEVERE, null, ex);</span>
<span class="nc" id="L160">        }</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (auction instanceof Countdown) {</span>
            //setting auction
<span class="nc" id="L163">            Countdown countdownAuction = (Countdown) auction;</span>
<span class="nc" id="L164">            countdownAuction.setPrice();</span>
<span class="nc" id="L165">            countdownCurrentPrice.setText(&quot;€&quot; + countdownAuction.getCurrentPrice());</span>
<span class="nc" id="L166">            timeline.playFromStart();</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">            if (auction.getProductQuantity()</span>
                    &gt; 1) {
<span class="nc" id="L169">                countdownAvailableUnits.setText(&quot;There are &quot; + auction.getProductQuantity() + &quot; units available&quot;);</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">            } else if (auction.getProductQuantity()</span>
                    == 1) {
<span class="nc" id="L172">                countdownAvailableUnits.setText(&quot;There is just 1 item left&quot;);</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">            } else if (auction.getProductQuantity()</span>
                    == 0) {
<span class="nc" id="L175">                countdownAvailableUnits.setText(&quot;There are no items left, you missed it&quot;);</span>
            }

<span class="nc" id="L178">            setCountdownBuys(auction);</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">        } else if (auction instanceof Standard) {</span>
<span class="nc" id="L180">            standardAuction = (Standard) auction;</span>
<span class="nc" id="L181">            countdownCurrentPrice.setText(&quot;€&quot; + standardAuction.getCurrentPrice());</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">            if (auction.getProductQuantity()</span>
                    &gt;= 1) {
<span class="nc" id="L184">                countdownAvailableUnits.setText(&quot;You're Buying &quot; + auction.getProductQuantity() + &quot; units for this price!&quot;);</span>
            }

<span class="nc" id="L187">            setCountdownBuys(auction);</span>
        }
<span class="nc" id="L189">    }</span>

    public void update() {
<span class="nc" id="L192">        int updateid = auction.getId();</span>
        try {
<span class="nc" id="L194">            auction = RM.getAuction().getAuction(updateid);</span>
<span class="nc" id="L195">        } catch (RemoteException ex) {</span>
<span class="nc" id="L196">            Logger.getLogger(AuctionController.class.getName()).log(Level.SEVERE, null, ex);</span>
<span class="nc" id="L197">        }</span>
<span class="nc" id="L198">        productTitle.setText(auction.getProduct().getName());</span>
<span class="nc" id="L199">        productDescription.setText(auction.getProduct().getDescription());</span>
<span class="nc" id="L200">        auctionDescription.setText(auction.getDescription());</span>
<span class="nc" id="L201">        productStatus.setText(setStatus(auction.getStatus()));</span>
<span class="nc" id="L202">        int i = 0;</span>
<span class="nc" id="L203">        Pane imagePane = new Pane();</span>
<span class="nc" id="L204">        imagePane.setPrefWidth(85 * auction.getImageURLs().length);</span>
<span class="nc" id="L205">        imagePane.setPrefHeight(70);</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">        for (String URL : auction.getImageURLs()) {</span>
<span class="nc" id="L207">            ImageView image = null;</span>
            try {
<span class="nc" id="L209">                image = new ImageView(new Image(URL));</span>
<span class="nc" id="L210">            } catch (Exception ex) {</span>
<span class="nc" id="L211">                image = new ImageView(new Image(this.getClass().getResource(&quot;/Classes/unavailable.jpg&quot;).toExternalForm()));</span>
<span class="nc" id="L212">                        Logger.getLogger(AuctionController.class.getName()).log(Level.SEVERE, null, ex);</span>
<span class="nc" id="L213">            }</span>
<span class="nc" id="L214">            image.setFitWidth(80);</span>
<span class="nc" id="L215">            image.setFitHeight(60);</span>
<span class="nc" id="L216">            image.relocate(85 * i, 5);</span>
<span class="nc" id="L217">            image.addEventHandler(MouseEvent.MOUSE_ENTERED,</span>
<span class="nc" id="L218">                    new EventHandler&lt;MouseEvent&gt;() {</span>
                @Override
                public void handle(MouseEvent e) {
<span class="nc" id="L221">                    ImageView i = (ImageView) e.getSource();</span>
<span class="nc" id="L222">                    bigProductImage.setImage(i.getImage());</span>
<span class="nc" id="L223">                }</span>
            });
<span class="nc" id="L225">            Image bigImage = null;</span>
            try {
<span class="nc" id="L227">                bigImage = new Image(auction.getImageURLs()[0]);</span>
<span class="nc" id="L228">            } catch (Exception ex) {</span>
<span class="nc" id="L229">                bigImage = new Image(this.getClass().getResource(&quot;/Classes/unavailable.jpg&quot;).toExternalForm());</span>
<span class="nc" id="L230">                                    Logger.getLogger(AuctionController.class.getName()).log(Level.SEVERE, null, ex);</span>
<span class="nc" id="L231">}</span>

<span class="nc" id="L233">            bigProductImage.setImage(bigImage);</span>
<span class="nc" id="L234">            imagePane.getChildren().add(image);</span>
<span class="nc" id="L235">            i++;</span>
        }

<span class="nc" id="L238">        sellerImage.setImage(new Image(auction.getSeller().getImageURL()));</span>
<span class="nc" id="L239">        sellerName.setText(auction.getSeller().getUsername());</span>
<span class="nc" id="L240">        imagesPane.setContent(imagePane);</span>

        // Checks if auction has instabuy.
<span class="nc bnc" id="L243" title="All 2 branches missed.">        if (auction.isInstabuyable() == true) {</span>
<span class="nc" id="L244">            countdownBuyBtn.setDisable(false);</span>
<span class="nc" id="L245">            txtUnitstoBuy.setDisable(false);</span>

        } else {
<span class="nc" id="L248">            countdownBuyBtn.setDisable(true);</span>
<span class="nc" id="L249">            txtUnitstoBuy.setDisable(true);</span>
        }

        //Checks if auction is of instance Countdown
<span class="nc bnc" id="L253" title="All 2 branches missed.">        if (auction instanceof Countdown) {</span>
            //setting auction
<span class="nc" id="L255">            auctiontype.setText(&quot;Countdown Auction&quot;);</span>
<span class="nc" id="L256">            Countdown countdownAuction = (Countdown) auction;</span>
<span class="nc" id="L257">            countdownAuction.setPrice();</span>

            //setting buttons etc:
<span class="nc" id="L260">            txtPriceToBid.setVisible(false);</span>
<span class="nc" id="L261">            txtPriceToBid.setText(countdownAuction.getCurrentPrice() + &quot;&quot;);</span>
<span class="nc" id="L262">            BidBtn.setVisible(false);</span>
<span class="nc" id="L263">            lblBid.setVisible(false);</span>
<span class="nc" id="L264">            txtUnitstoBuyBid.setVisible(true);</span>
<span class="nc" id="L265">            buyButton.setVisible(true);</span>
<span class="nc" id="L266">            lblUnits.setVisible(true);</span>

<span class="nc" id="L268">            countdownCurrentPrice.setText(&quot;€&quot; + countdownAuction.getCurrentPrice());</span>
<span class="nc" id="L269">            InstabuyCurrentPrice.setText(&quot;€&quot; + countdownAuction.getInstabuyPrice());</span>
<span class="nc" id="L270">            long now = System.currentTimeMillis();</span>
<span class="nc" id="L271">            long then = countdownAuction.getCreationDate().getTime();</span>
<span class="nc" id="L272">            long periods_passed = (long) Math.floor(((now - then) / 1000 / 60 / (int) countdownAuction.getPriceLoweringDelay()));</span>
<span class="nc" id="L273">            long next_period_begin = ((periods_passed + 1) * 1000 * 60 * (int) countdownAuction.getPriceLoweringDelay()) + countdownAuction.getCreationDate().getTime();</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">            if (timeline != null) {</span>
<span class="nc" id="L275">                timeline.stop();</span>
            }
<span class="nc" id="L277">            timeline = null;</span>
<span class="nc" id="L278">            timeline = new Timeline();</span>
<span class="nc" id="L279">            timeline.setCycleCount(Timeline.INDEFINITE);</span>
<span class="nc" id="L280">            long duration = (next_period_begin - System.currentTimeMillis()) / 1000;</span>
<span class="nc" id="L281">            timeSeconds = (int) duration;</span>
<span class="nc" id="L282">            timeline.getKeyFrames().add(new KeyFrame(Duration.seconds(1), new EventHandler() {</span>

                @Override
                public void handle(Event event) {
<span class="nc" id="L286">                    timeSeconds--;</span>
<span class="nc" id="L287">                    int minutesToGo = (int) Math.floor(timeSeconds / 60.0);</span>
<span class="nc" id="L288">                    int secondsToGo = timeSeconds - (minutesToGo * 60);</span>
<span class="nc" id="L289">                    String minutes = Integer.toString(minutesToGo);</span>
<span class="nc" id="L290">                    String seconds = Integer.toString(secondsToGo);</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">                    if (minutesToGo &lt; 10) {</span>
<span class="nc" id="L292">                        minutes = &quot;0&quot; + minutes;</span>
                    }
<span class="nc bnc" id="L294" title="All 2 branches missed.">                    if (secondsToGo &lt; 10) {</span>
<span class="nc" id="L295">                        seconds = &quot;0&quot; + seconds;</span>
                    }
<span class="nc" id="L297">                    CreateDate.setText(minutes + &quot;:&quot; + seconds);</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">                    if (minutesToGo &lt;= 0) {</span>
<span class="nc" id="L299">                        minutesBar.setProgress(-1);</span>
                    } else {
<span class="nc" id="L301">                        minutesBar.setProgress(timeSeconds / (countdownAuction.getPriceLoweringDelay() * 60));</span>
                    }
<span class="nc bnc" id="L303" title="All 2 branches missed.">                    if (timeSeconds &lt;= 0) {</span>
<span class="nc" id="L304">                        timeline.stop();</span>
<span class="nc" id="L305">                        update();</span>
                    }
<span class="nc" id="L307">                }</span>
            }));
<span class="nc" id="L309">            timeline.playFromStart();</span>

<span class="nc bnc" id="L311" title="All 2 branches missed.">            if (auction.getProductQuantity()</span>
                    &gt; 1) {
<span class="nc" id="L313">                countdownAvailableUnits.setText(&quot;There are &quot; + auction.getProductQuantity() + &quot; units available&quot;);</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">            } else if (auction.getProductQuantity()</span>
                    == 1) {
<span class="nc" id="L316">                countdownAvailableUnits.setText(&quot;There is just 1 item left&quot;);</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">            } else if (auction.getProductQuantity()</span>
                    == 0) {
<span class="nc" id="L319">                countdownAvailableUnits.setText(&quot;There are no items left, you missed it&quot;);</span>
            }

<span class="nc" id="L322">            setCountdownBuys(auction);</span>

<span class="nc bnc" id="L324" title="All 2 branches missed.">        } else if (auction instanceof Standard) {</span>
            //setting correct buttons:           
<span class="nc" id="L326">            txtPriceToBid.setVisible(true);</span>
<span class="nc" id="L327">            BidBtn.setVisible(true);</span>
<span class="nc" id="L328">            lblBid.setVisible(true);</span>
<span class="nc" id="L329">            txtUnitstoBuyBid.setVisible(false);</span>
<span class="nc" id="L330">            buyButton.setVisible(false);</span>
<span class="nc" id="L331">            lblUnits.setVisible(false);</span>

<span class="nc" id="L333">            this.type = &quot;standard&quot;;</span>
<span class="nc" id="L334">            this.minutesBar.setVisible(false);</span>
<span class="nc" id="L335">            auctiontype.setText(&quot;Standard Auction&quot;);</span>
<span class="nc" id="L336">            standardAuction = (Standard) auction;</span>
<span class="nc" id="L337">            countdownCurrentPrice.setText(&quot;€&quot; + standardAuction.getCurrentPrice());</span>
<span class="nc" id="L338">            InstabuyCurrentPrice.setText(&quot;€&quot; + standardAuction.getInstabuyPrice());</span>

<span class="nc" id="L340">            Timestamp newDate = standardAuction.getCreationDate();</span>
<span class="nc" id="L341">            CreateDate.setText(newDate.getMonth() + &quot;/&quot; + newDate.getDay() + &quot;  &quot; + newDate.getHours() + &quot;:&quot; + newDate.getMinutes() + &quot;:&quot; + newDate.getSeconds());</span>

<span class="nc bnc" id="L343" title="All 2 branches missed.">            if (auction.getProductQuantity()</span>
                    &gt;= 1) {
<span class="nc" id="L345">                countdownAvailableUnits.setText(&quot;You're Buying &quot; + auction.getProductQuantity() + &quot; units for this price!&quot;);</span>
            }

<span class="nc" id="L348">            setCountdownBuys(auction);</span>
<span class="nc" id="L349">            long now = System.currentTimeMillis();</span>
<span class="nc" id="L350">            long then = standardAuction.getEndDate().getTime();</span>
<span class="nc" id="L351">            timeSeconds = (int) ((now - then) / 1000);</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">            if (timeline != null) {</span>
<span class="nc" id="L353">                timeline.stop();</span>
            }
<span class="nc" id="L355">            timeline = null;</span>
<span class="nc" id="L356">            timeline = new Timeline();</span>
<span class="nc" id="L357">            timeline.setCycleCount(Timeline.INDEFINITE);</span>
<span class="nc" id="L358">            timeline.getKeyFrames().add(new KeyFrame(Duration.seconds(1), new EventHandler() {</span>

                @Override
                public void handle(Event event) {
<span class="nc" id="L362">                    timeSeconds--;</span>
<span class="nc" id="L363">                    int timeDays = timeSeconds;</span>
<span class="nc" id="L364">                    int daysToGo = (int) Math.floor(timeDays / 60.0 / 60 / 24.0);</span>
<span class="nc" id="L365">                    int hoursToGo = (int) Math.floor(timeSeconds / 60 / 60.0) - daysToGo * 24;</span>
<span class="nc" id="L366">                    int minutesToGo = (int) Math.floor(timeSeconds / 60.0)-(hoursToGo*60)-(daysToGo*24*60);</span>
<span class="nc" id="L367">                    int secondsToGo = timeSeconds -(hoursToGo*60*60)-(daysToGo*24*60*60)-(minutesToGo*60);</span>
<span class="nc" id="L368">                    String hours = Integer.toString(hoursToGo);</span>
<span class="nc" id="L369">                    String minutes = Integer.toString(minutesToGo);</span>
<span class="nc" id="L370">                    String seconds = Integer.toString(secondsToGo);</span>
<span class="nc bnc" id="L371" title="All 2 branches missed.">                    if (hoursToGo &lt; 10) {</span>
<span class="nc" id="L372">                        hours = &quot;0&quot; + hours;</span>
                    }
<span class="nc bnc" id="L374" title="All 2 branches missed.">                    if (minutesToGo &lt; 10) {</span>
<span class="nc" id="L375">                        minutes = &quot;0&quot; + minutes;</span>
                    }
<span class="nc bnc" id="L377" title="All 2 branches missed.">                    if (secondsToGo &lt; 10) {</span>
<span class="nc" id="L378">                        seconds = &quot;0&quot; + seconds;</span>
                    }
<span class="nc" id="L380">                    CreateDate.setText(daysToGo + &quot;Days,  &quot; + hours + &quot;:&quot; + minutes + &quot;:&quot; + seconds);</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">                    if (timeSeconds &lt;= 0) {</span>
<span class="nc" id="L382">                        timeline.stop();</span>
<span class="nc" id="L383">                        update();</span>
                    }
<span class="nc" id="L385">                }</span>
            }));
<span class="nc" id="L387">            timeline.playFromStart();</span>

        }

<span class="nc bnc" id="L391" title="All 2 branches missed.">        if (auction instanceof Direct) {</span>
<span class="nc" id="L392">            this.type = &quot;direct&quot;;</span>
<span class="nc" id="L393">            auctiontype.setText(&quot;Direct Auction&quot;);</span>
<span class="nc" id="L394">            directAuction = (Direct) auction;</span>
<span class="nc" id="L395">            countdownCurrentPrice.setText(&quot;€&quot; + directAuction.getCurrentPrice());</span>
<span class="nc" id="L396">            InstabuyCurrentPrice.setText(&quot;€&quot; + directAuction.getInstabuyPrice());</span>

<span class="nc" id="L398">            Timestamp newDate = directAuction.getCreationDate();</span>
<span class="nc" id="L399">            CreateDate.setText(newDate.getMonth() + &quot;/&quot; + newDate.getDay() + &quot;  &quot; + newDate.getHours() + &quot;:&quot; + newDate.getMinutes() + &quot;:&quot; + newDate.getSeconds());</span>

<span class="nc bnc" id="L401" title="All 2 branches missed.">            if (auction.getProductQuantity()</span>
                    &gt; 1) {
<span class="nc" id="L403">                countdownAvailableUnits.setText(&quot;There are &quot; + auction.getProductQuantity() + &quot; units available&quot;);</span>
<span class="nc bnc" id="L404" title="All 2 branches missed.">            } else if (auction.getProductQuantity()</span>
                    == 1) {
<span class="nc" id="L406">                countdownAvailableUnits.setText(&quot;There is just 1 item left&quot;);</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">            } else if (auction.getProductQuantity()</span>
                    == 0) {
<span class="nc" id="L409">                countdownAvailableUnits.setText(&quot;There are no items left, you missed it&quot;);</span>
            }

<span class="nc" id="L412">            setCountdownBuys(auction);</span>

        }

<span class="nc" id="L416">        txtUnitstoBuy.textProperty().addListener(new ChangeListener&lt;String&gt;() {</span>
            @Override
            public void changed(ObservableValue&lt;? extends String&gt; observable, String oldValue, String newValue) {
<span class="nc bnc" id="L419" title="All 2 branches missed.">                if (!newValue.matches(&quot;\\d*&quot;)) {</span>
<span class="nc" id="L420">                    txtUnitstoBuy.setText(newValue.replaceAll(&quot;[^\\d]&quot;, &quot;&quot;));</span>
                }
<span class="nc" id="L422">            }</span>
        });
<span class="nc" id="L424">    }</span>

    /**
     * Returns textual status
     *
     * @param status StatusEnum
     * @return
     */
    public String setStatus(StatusEnum status) {
<span class="nc bnc" id="L433" title="All 7 branches missed.">        switch (status) {</span>
            case New:
<span class="nc" id="L435">                return &quot;New&quot;;</span>
            case GoodAsNew:
<span class="nc" id="L437">                return &quot;As good as new&quot;;</span>
            case Refurbished:
<span class="nc" id="L439">                return &quot;Refurbished&quot;;</span>
            case Used_Good:
<span class="nc" id="L441">                return &quot;little damage(small dents)&quot;;</span>
            case Used_Bad:
<span class="nc" id="L443">                return &quot;annoying damage(Cracks)&quot;;</span>
            case Broken:
<span class="nc" id="L445">                return &quot;not fully functional or Broken&quot;;</span>
            default:
<span class="nc" id="L447">                return &quot;&quot;;</span>
        }
    }

    public void buyButtonClick() throws RemoteException, NotEnoughMoneyException, SQLException {
<span class="nc" id="L452">        RM.getPlaceBidInterface();</span>
<span class="nc" id="L453">        this.bid = RM.getBid();</span>
<span class="nc bnc" id="L454" title="All 4 branches missed.">        if (Integer.parseInt(txtUnitstoBuyBid.getText()) &gt;= 1 &amp;&amp; Integer.parseInt(txtUnitstoBuyBid.getText()) &lt;= auction.getProductQuantity()) {</span>
<span class="nc" id="L455">            double totalprice = Double.parseDouble(txtUnitstoBuyBid.getText()) * auction.getCurrentPrice();</span>
<span class="nc" id="L456">            int reply = JOptionPane.showConfirmDialog(null, &quot;Are you sure you want to Buy &quot; + txtUnitstoBuyBid.getText() + &quot; items with a total price of: €&quot; + totalprice + &quot; ?&quot;, &quot;Are You Sure?&quot;, JOptionPane.YES_NO_OPTION);</span>
<span class="nc bnc" id="L457" title="All 2 branches missed.">            if (reply == JOptionPane.YES_OPTION) {</span>
<span class="nc" id="L458">                int units = Integer.parseInt(txtUnitstoBuyBid.getText());</span>
<span class="nc" id="L459">                bid.placeBuy(units, loggedInUser.getUsername(), auction.getId(), auction.getCurrentPrice());</span>
<span class="nc" id="L460">                update();</span>
<span class="nc" id="L461">                JOptionPane.showMessageDialog(null, &quot;Your order has been placed&quot;);</span>
<span class="nc" id="L462">            } else {</span>
<span class="nc" id="L463">                JOptionPane.showMessageDialog(null, &quot;Canceled&quot;);</span>
            }
<span class="nc bnc" id="L465" title="All 2 branches missed.">        } else if (Integer.parseInt(txtUnitstoBuyBid.getText()) &lt; 1) {</span>
<span class="nc" id="L466">            JOptionPane.showMessageDialog(null, &quot;You can't buy less than 1 object&quot;);</span>
<span class="nc bnc" id="L467" title="All 2 branches missed.">        } else if (Integer.parseInt(txtUnitstoBuyBid.getText()) &gt; auction.getProductQuantity()) {</span>
<span class="nc" id="L468">            JOptionPane.showMessageDialog(null, &quot;You can't buy more objects than there are available&quot;);</span>
        } else {
<span class="nc" id="L470">            JOptionPane.showMessageDialog(null, &quot;Something went wrong&quot;);</span>
        }
<span class="nc" id="L472">        checkAuctionStatus();</span>
<span class="nc" id="L473">    }</span>

    public void bidButtonClick() throws RemoteException, NotEnoughMoneyException, SQLException {
<span class="nc" id="L476">        RM.getPlaceBidInterface();</span>
<span class="nc" id="L477">        this.bid = RM.getBid();</span>
<span class="nc bnc" id="L478" title="All 4 branches missed.">        if (auction.getCurrentPrice() &lt; Double.parseDouble(txtPriceToBid.getText())&amp;&amp;Double.parseDouble(txtPriceToBid.getText())&lt;auction.getInstabuyPrice()) {</span>
<span class="nc" id="L479">            int reply = JOptionPane.showConfirmDialog(null, &quot;Are you sure you want to Bid &quot; + txtPriceToBid.getText(), &quot;Are You Sure?&quot;, JOptionPane.YES_NO_OPTION);</span>
<span class="nc bnc" id="L480" title="All 2 branches missed.">            if (reply == JOptionPane.YES_OPTION) {</span>
<span class="nc" id="L481">                bid.placeBid(1, loggedInUser.getUsername(), auction.getId(), Double.parseDouble(txtPriceToBid.getText()));</span>
<span class="nc" id="L482">                update();</span>
<span class="nc" id="L483">                JOptionPane.showMessageDialog(null, &quot;Your bid has been placed&quot;);</span>
            } else {
<span class="nc" id="L485">                JOptionPane.showMessageDialog(null, &quot;Canceled&quot;);</span>
            }
<span class="nc bnc" id="L487" title="All 2 branches missed.">        } else if (auction.getCurrentPrice() &gt; Double.parseDouble(txtPriceToBid.getText())) {</span>
<span class="nc" id="L488">            JOptionPane.showMessageDialog(null, &quot;You can't bid less than current price&quot;);</span>
        } else {
<span class="nc" id="L490">            JOptionPane.showMessageDialog(null, &quot;Something went wrong&quot;);</span>
        }
<span class="nc" id="L492">        checkAuctionStatus();</span>
<span class="nc" id="L493">    }</span>

    public void instabuyButtonClick() throws RemoteException, NotEnoughMoneyException, SQLException {
<span class="nc" id="L496">        RM.getPlaceBidInterface();</span>
<span class="nc" id="L497">        this.bid = RM.getBid();</span>

<span class="nc bnc" id="L499" title="All 6 branches missed.">        if (Integer.parseInt(txtUnitstoBuy.getText()) &lt;= auction.getProductQuantity() &amp;&amp; Integer.parseInt(txtUnitstoBuy.getText()) &gt; 0 &amp;&amp; auction != null) {</span>
<span class="nc" id="L500">            double totalPrice = Double.parseDouble(txtUnitstoBuy.getText()) * auction.getInstabuyPrice();</span>

<span class="nc" id="L502">            int reply = JOptionPane.showConfirmDialog(null, &quot;Are you sure you want to buy &quot; + txtUnitstoBuy.getText() + &quot;\nitems with the price of: €&quot; + auction.getInstabuyPrice() + &quot; a item \nand a total of: €&quot; + totalPrice, &quot;Are you sure?&quot;, JOptionPane.YES_NO_OPTION);</span>
<span class="nc bnc" id="L503" title="All 2 branches missed.">            if (reply == JOptionPane.YES_OPTION) {</span>
<span class="nc" id="L504">                int units = Integer.parseInt(txtUnitstoBuy.getText());</span>
<span class="nc" id="L505">                bid.placeBid(units, loggedInUser.getUsername(), auction.getId(), auction.getInstabuyPrice());</span>
<span class="nc" id="L506">                update();</span>
<span class="nc" id="L507">            } else {</span>
<span class="nc" id="L508">                JOptionPane.showMessageDialog(null, &quot;Canceled&quot;);</span>
            }
<span class="nc bnc" id="L510" title="All 2 branches missed.">        } else if (Integer.parseInt(txtUnitstoBuy.getText()) &lt;= 0) {</span>
<span class="nc" id="L511">            JOptionPane.showMessageDialog(null, &quot;You can't buy less than 1 object&quot;);</span>
        } else {
<span class="nc" id="L513">            JOptionPane.showMessageDialog(null, &quot;You can't buy more objects than there are available&quot;);</span>
        }
<span class="nc" id="L515">        checkAuctionStatus();</span>
<span class="nc" id="L516">    }</span>

    public void setCountdownBuys(Auction auction) {
<span class="nc" id="L519">        Pane BuyPane = new Pane();</span>
<span class="nc" id="L520">        BuyPane.setPrefWidth(371);</span>
<span class="nc" id="L521">        BuyPane.setPrefHeight(75 * auction.getBids().size());</span>
<span class="nc" id="L522">        int a = 0;</span>
<span class="nc" id="L523">        ArrayList&lt;Bid&gt; bids = auction.getBids();</span>
<span class="nc" id="L524">        Collections.reverse(bids);</span>
<span class="nc bnc" id="L525" title="All 2 branches missed.">        for (Bid b : bids) {</span>
<span class="nc" id="L526">            Pane p = new Pane();</span>
<span class="nc" id="L527">            p.setPrefHeight(75);</span>
<span class="nc" id="L528">            p.setPrefWidth(371);</span>
<span class="nc" id="L529">            p.relocate(0, a * 75);</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">            if ((a % 2) == 0) {</span>
<span class="nc" id="L531">                p.setStyle(&quot;-fx-background-color: lightgrey &quot;);</span>
            }
<span class="nc" id="L533">            Label name = new Label();</span>
<span class="nc" id="L534">            name.setText(b.getPlacerUsername());</span>
<span class="nc" id="L535">            name.setFont(new Font(&quot;Arial&quot;, 17));</span>
<span class="nc" id="L536">            Label price = new Label();</span>
<span class="nc bnc" id="L537" title="All 4 branches missed.">            if (auction instanceof Countdown || auction instanceof Direct) {</span>
<span class="nc" id="L538">                price.setText(&quot;Bought at a price of: €&quot; + b.getAmount());</span>
            } else {
<span class="nc" id="L540">                price.setText(&quot;Bidded: €&quot; + b.getAmount() + &quot; for this item&quot;);</span>
            }
<span class="nc" id="L542">            price.setFont(new Font(&quot;Arial&quot;, 14));</span>
<span class="nc" id="L543">            name.relocate(10, 15);</span>
<span class="nc" id="L544">            price.relocate(10, 45);</span>
<span class="nc" id="L545">            p.getChildren().addAll(price, name);</span>
<span class="nc" id="L546">            BuyPane.getChildren().add(p);</span>
<span class="nc" id="L547">            a++;</span>
<span class="nc" id="L548">        }</span>

<span class="nc" id="L550">        recentPurchasesPane.setContent(BuyPane);</span>
<span class="nc" id="L551">    }</span>

    /**
     * if items in the auction are less then one, the auction closes
     */
    public void checkAuctionStatus() throws SQLException {
<span class="nc bnc" id="L557" title="All 2 branches missed.">        if (auction instanceof Countdown) {</span>
<span class="nc" id="L558">            Countdown countdown = (Countdown) auction;</span>
<span class="nc bnc" id="L559" title="All 2 branches missed.">            if (countdown.getProductQuantity() &lt; 1) {</span>
<span class="nc" id="L560">                GX.closeAuction();</span>
<span class="nc" id="L561">                System.out.println(&quot;Verwijderd uit de databsase&quot;);</span>
<span class="nc" id="L562">                closeButtonClick();</span>
            }
<span class="nc bnc" id="L564" title="All 2 branches missed.">        } else if (auction instanceof Direct) {</span>
<span class="nc" id="L565">            Direct direct = (Direct) auction;</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">            if (direct.getProductQuantity() &lt; 1) {</span>
<span class="nc" id="L567">                GX.closeAuction();</span>
<span class="nc" id="L568">                System.out.println(&quot;Verwijderd uit de databsase&quot;);</span>
<span class="nc" id="L569">                closeButtonClick();</span>
            }
<span class="nc bnc" id="L571" title="All 2 branches missed.">        } else if (auction instanceof Standard) {</span>
<span class="nc" id="L572">            Standard standard = (Standard) auction;</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">            if (standard.getProductQuantity() &lt; 1) {</span>
<span class="nc" id="L574">                GX.closeAuction();</span>
<span class="nc" id="L575">                System.out.println(&quot;Verwijderd uit de databsase&quot;);</span>
<span class="nc" id="L576">                closeButtonClick();</span>
            }
        }

<span class="nc" id="L580">    }</span>

    @FXML
    private void closeButtonClick() {
<span class="nc" id="L584">        Stage stage = (Stage) closeButton.getScene().getWindow();</span>
<span class="nc" id="L585">        stage.close();</span>
<span class="nc" id="L586">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>